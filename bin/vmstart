#!/bin/bash

usage() {
cat << EOS
usage: vmstart [-h] [search]

  -h: help

vagrantをどこからでも起動できるようにするコマンドです。
第一引数に文字列を渡すとその文字列でgrepしたもの、渡さなかった場合はpecoで選択したものを起動します。

require: peco
EOS
}

# options
while getopts h OPT
do
  case $OPT in
    "h" ) MODE="HELP" ;;
  esac
done

shift $((OPTIND - 1))

if [ "$MODE" = "HELP" ]; then
    usage
    exit 1
fi

machine=$(vmselect "$@")

machineId=$(echo $machine | cut -d " " -f 1)
machineStat=$(echo $machine | cut -d " " -f 3)
machinePath=$(echo $machine | cut -d " " -f 4)


echo -e "\033[0;36mvagrant up $machinePath\033[0;m"

if [ $machineStat = "poweroff" ]; then
  vagrant up $machineId
elif [[ $machineStat = "saved" ]]; then
  vagrant resume $machineId
elif [ $machineStat = "aborted" ]; then
  vagrant reload $machineId
fi

